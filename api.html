<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🏦</text></svg>">
    <title>전세대출 금리 조회</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

      :root {
        --primary-color: #4CAF50;
        --secondary-color: #2196F3;
        --background-color: #121212;
        --card-color: #1E1E1E;
        --text-color: #E0E0E0;
        --error-color: #CF6679;
        --success-color: #4CAF50;
        --border-color: #333333;
        --hover-color: #2A2A2A;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Noto Sans KR', sans-serif;
        background-color: var(--background-color);
        color: var(--text-color);
        line-height: 1.6;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }

      .container {
        background-color: var(--card-color);
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      }

      h1 {
        color: var(--text-color);
        text-align: center;
        margin-bottom: 30px;
        font-size: 2.2em;
        font-weight: 700;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--text-color);
      }

      select {
        width: 100%;
        padding: 12px;
        background-color: var(--background-color);
        color: var(--text-color);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        font-size: 1em;
        transition: all 0.3s ease;
      }

      select:hover {
        border-color: var(--primary-color);
      }

      select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
      }

      button {
        width: 100%;
        padding: 14px;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.1em;
        font-weight: 500;
        transition: all 0.3s ease;
        margin-top: 20px;
      }

      button:hover {
        background-color: #45a049;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
      }

      .result {
        margin-top: 30px;
        padding: 20px;
        background-color: var(--background-color);
        border-radius: 12px;
        display: none;
        border: 1px solid var(--border-color);
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      }

      .result h2 {
        color: var(--text-color);
        margin-bottom: 20px;
        font-size: 1.5em;
        font-weight: 600;
        text-align: center;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--border-color);
      }

      .error {
        color: var(--error-color);
        margin-top: 15px;
        padding: 12px;
        background-color: rgba(207, 102, 121, 0.1);
        border-radius: 8px;
        display: none;
      }

      .rate-info {
        background-color: var(--card-color);
        border-radius: 10px;
        padding: 15px;
        margin-top: 20px;
        border: 1px solid var(--border-color);
      }

      .rate-item {
        margin-bottom: 10px;
      }

      .rate-label {
        font-weight: bold;
        color: #333;
      }

      .rate-value {
        color: #4CAF50;
        font-size: 1.2em;
      }

      .rate-list {
        margin-top: 20px;
      }

      .bank-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        border-bottom: 1px solid var(--border-color);
        transition: all 0.3s ease;
        background-color: var(--background-color);
        border-radius: 8px;
        margin-bottom: 10px;
      }

      .bank-item:hover {
        background-color: var(--hover-color);
        transform: translateX(5px);
      }

      .bank-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }

      .bank-name {
        font-weight: 500;
        color: var(--text-color);
        font-size: 1.1em;
        display: flex;
        align-items: center;
      }

      .bank-name::before {
        content: "🏦";
        margin-right: 10px;
        font-size: 1.2em;
      }

      .bank-rate {
        color: var(--primary-color);
        font-weight: 600;
        font-size: 1.2em;
        background-color: rgba(76, 175, 80, 0.1);
        padding: 5px 12px;
        border-radius: 15px;
        display: flex;
        align-items: center;
      }

      .bank-rate::after {
        content: "%";
        margin-left: 3px;
        font-size: 0.9em;
      }

      .no-data {
        text-align: center;
        color: var(--text-color);
        padding: 30px;
        font-size: 1.1em;
        opacity: 0.8;
      }

      .no-data::before {
        content: "⚠️";
        display: block;
        font-size: 2em;
        margin-bottom: 15px;
      }

      @media (max-width: 768px) {
        .container {
          padding: 20px;
        }

        h1 {
          font-size: 1.8em;
        }

        select, button {
          padding: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>전세대출 금리 조회</h1>
      
      <div class="form-group">
        <label for="cbGrd">CB 등급</label>
        <select id="cbGrd">
          <option value="1">CB 1등급</option>
          <option value="2">CB 2등급</option>
          <option value="3">CB 3등급</option>
          <option value="4">CB 4등급</option>
          <option value="5">CB 5등급</option>
        </select>
      </div>

      <div class="form-group">
        <label for="jobCd">직업</label>
        <select id="jobCd">
          <option value="01">직장인</option>
          <option value="02">자영업자</option>
          <option value="03">기타</option>
        </select>
      </div>

      <div class="form-group">
        <label for="houseTycd">주택유형</label>
        <select id="houseTycd">
          <option value="06">아파트</option>
          <option value="01">다세대</option>
          <option value="02">다가구</option>
          <option value="03">단독주택</option>
          <option value="05">연립주택</option>
          <option value="10">오피스텔</option>
          <option value="99">기타</option>
        </select>
      </div>

      <div class="form-group">
        <label for="age">연령대</label>
        <select id="age">
          <option value="3">30대</option>
          <option value="1">10대</option>
          <option value="2">20대</option>
          <option value="4">40대</option>
          <option value="5">50대</option>
          <option value="6">60대</option>
          <option value="7">70대</option>
          <option value="8">80대</option>
          <option value="9">90대 이상</option>
        </select>
      </div>

      <button onclick="fetchRate()">금리 조회하기</button>

      <div id="result" class="result">
        <h2>조회 결과</h2>
        <div class="rate-info">
          <div class="rate-list">
            <!-- 여기에 은행 목록이 동적으로 추가됩니다 -->
          </div>
        </div>
      </div>

      <div id="error" class="error"></div>
    </div>

    <script>
      async function fetchRate() {
        const result = document.getElementById('result');
        const error = document.getElementById('error');
        const rateList = document.querySelector('.rate-list');
        
        result.style.display = 'none';
        error.style.display = 'none';
        rateList.innerHTML = '';
        
        try {
          const serviceKey = encodeURIComponent('Fd9vStrV5WKcvb5kTCXeBBw1zyOOxNrOysX80lQ02PLaIWqI7PFfY7PlcJopX/3kd5FYkiHYt6QYbhItGuhIhQ==');
          const params = new URLSearchParams({
            serviceKey: serviceKey,
            cbGrd: document.getElementById('cbGrd').value,
            jobCd: document.getElementById('jobCd').value,
            houseTycd: document.getElementById('houseTycd').value,
            age: document.getElementById('age').value,
            dataType: 'XML',
            numOfRows: '100',
            pageNo: '1'
          });

          const url = `http://apis.data.go.kr/B551408/rent-loan-rate-info/rate-list?serviceKey=${serviceKey}&numOfRows=10&pageNo=1&dataType=xml`;
          console.log('요청 URL:', url);
          
          const response = await fetch(url);
          const text = await response.text();
          console.log('응답 데이터:', text);
          
          const parser = new DOMParser();
          const xmlDoc = parser.parseFromString(text, 'text/xml');
          
          const items = xmlDoc.querySelectorAll('item');
          console.log('파싱된 아이템 수:', items.length);
          
          if (items.length === 0) {
            throw new Error('데이터가 없습니다.');
          }

          // 은행 데이터를 배열로 변환
          const banks = Array.from(items).map(item => ({
            name: item.querySelector('organId')?.textContent || '-',
            interest: parseFloat(item.querySelector('interest4_1')?.textContent || '0')
          }));

          // 금리가 0보다 큰 은행만 필터링하고 금리순으로 정렬
          const validBanks = banks
            .filter(bank => bank.interest > 0)
            .sort((a, b) => a.interest - b.interest);

          if (validBanks.length === 0) {
            throw new Error('현재 전세대출 상품을 제공하는 은행이 없습니다.');
          }

          // 정렬된 은행 목록을 화면에 표시
          validBanks.forEach(bank => {
            const bankItem = document.createElement('div');
            bankItem.className = 'bank-item';
            bankItem.innerHTML = `
              <span class="bank-name">${bank.name}</span>
              <span class="bank-rate">${bank.interest}%</span>
            `;
            rateList.appendChild(bankItem);
          });

          result.style.display = 'block';
        } catch (error) {
          console.error('API 호출 오류:', error);
          document.getElementById('error').textContent = `오류 발생: ${error.message}`;
          document.getElementById('error').style.display = 'block';
        }
      }
    </script>
  </body>
</html>
