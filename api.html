<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¦</text></svg>">
    <title>ì „ì„¸ëŒ€ì¶œ ê¸ˆë¦¬ ì¡°íšŒ</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

      :root {
        --primary-color: #4CAF50;
        --secondary-color: #2196F3;
        --background-color: #121212;
        --card-color: #1E1E1E;
        --text-color: #E0E0E0;
        --error-color: #CF6679;
        --success-color: #4CAF50;
        --border-color: #333333;
        --hover-color: #2A2A2A;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Noto Sans KR', sans-serif;
        background-color: var(--background-color);
        color: var(--text-color);
        line-height: 1.6;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }

      .container {
        background-color: var(--card-color);
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      }

      h1 {
        color: var(--text-color);
        text-align: center;
        margin-bottom: 30px;
        font-size: 2.2em;
        font-weight: 700;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--text-color);
      }

      select {
        width: 100%;
        padding: 12px;
        background-color: var(--background-color);
        color: var(--text-color);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        font-size: 1em;
        transition: all 0.3s ease;
      }

      select:hover {
        border-color: var(--primary-color);
      }

      select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
      }

      button {
        width: 100%;
        padding: 14px;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.1em;
        font-weight: 500;
        transition: all 0.3s ease;
        margin-top: 20px;
      }

      button:hover {
        background-color: #45a049;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
      }

      .result {
        margin-top: 30px;
        padding: 20px;
        background-color: var(--background-color);
        border-radius: 12px;
        display: none;
        border: 1px solid var(--border-color);
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      }

      .result h2 {
        color: var(--text-color);
        margin-bottom: 20px;
        font-size: 1.5em;
        font-weight: 600;
        text-align: center;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--border-color);
      }

      .error {
        color: var(--error-color);
        margin-top: 15px;
        padding: 12px;
        background-color: rgba(207, 102, 121, 0.1);
        border-radius: 8px;
        display: none;
      }

      .rate-info {
        background-color: var(--card-color);
        border-radius: 10px;
        padding: 15px;
        margin-top: 20px;
        border: 1px solid var(--border-color);
      }

      .rate-item {
        margin-bottom: 10px;
      }

      .rate-label {
        font-weight: bold;
        color: #333;
      }

      .rate-value {
        color: #4CAF50;
        font-size: 1.2em;
      }

      .rate-list {
        margin-top: 20px;
      }

      .bank-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        border-bottom: 1px solid var(--border-color);
        transition: all 0.3s ease;
        background-color: var(--background-color);
        border-radius: 8px;
        margin-bottom: 10px;
      }

      .bank-item:hover {
        background-color: var(--hover-color);
        transform: translateX(5px);
      }

      .bank-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }

      .bank-name {
        font-weight: 500;
        color: var(--text-color);
        font-size: 1.1em;
        display: flex;
        align-items: center;
      }

      .bank-name::before {
        content: "ğŸ¦";
        margin-right: 10px;
        font-size: 1.2em;
      }

      .bank-rate {
        color: var(--primary-color);
        font-weight: 600;
        font-size: 1.2em;
        background-color: rgba(76, 175, 80, 0.1);
        padding: 5px 12px;
        border-radius: 15px;
        display: flex;
        align-items: center;
      }

      .bank-rate::after {
        content: "%";
        margin-left: 3px;
        font-size: 0.9em;
      }

      .no-data {
        text-align: center;
        color: var(--text-color);
        padding: 30px;
        font-size: 1.1em;
        opacity: 0.8;
      }

      .no-data::before {
        content: "âš ï¸";
        display: block;
        font-size: 2em;
        margin-bottom: 15px;
      }

      @media (max-width: 768px) {
        .container {
          padding: 20px;
        }

        h1 {
          font-size: 1.8em;
        }

        select, button {
          padding: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ì „ì„¸ëŒ€ì¶œ ê¸ˆë¦¬ ì¡°íšŒ</h1>
      
      <div class="form-group">
        <label for="cbGrd">CB ë“±ê¸‰</label>
        <select id="cbGrd">
          <option value="1">CB 1ë“±ê¸‰</option>
          <option value="2">CB 2ë“±ê¸‰</option>
          <option value="3">CB 3ë“±ê¸‰</option>
          <option value="4">CB 4ë“±ê¸‰</option>
          <option value="5">CB 5ë“±ê¸‰</option>
        </select>
      </div>

      <div class="form-group">
        <label for="jobCd">ì§ì—…</label>
        <select id="jobCd">
          <option value="01">ì§ì¥ì¸</option>
          <option value="02">ìì˜ì—…ì</option>
          <option value="03">ê¸°íƒ€</option>
        </select>
      </div>

      <div class="form-group">
        <label for="houseTycd">ì£¼íƒìœ í˜•</label>
        <select id="houseTycd">
          <option value="06">ì•„íŒŒíŠ¸</option>
          <option value="01">ë‹¤ì„¸ëŒ€</option>
          <option value="02">ë‹¤ê°€êµ¬</option>
          <option value="03">ë‹¨ë…ì£¼íƒ</option>
          <option value="05">ì—°ë¦½ì£¼íƒ</option>
          <option value="10">ì˜¤í”¼ìŠ¤í…”</option>
          <option value="99">ê¸°íƒ€</option>
        </select>
      </div>

      <div class="form-group">
        <label for="age">ì—°ë ¹ëŒ€</label>
        <select id="age">
          <option value="3">30ëŒ€</option>
          <option value="1">10ëŒ€</option>
          <option value="2">20ëŒ€</option>
          <option value="4">40ëŒ€</option>
          <option value="5">50ëŒ€</option>
          <option value="6">60ëŒ€</option>
          <option value="7">70ëŒ€</option>
          <option value="8">80ëŒ€</option>
          <option value="9">90ëŒ€ ì´ìƒ</option>
        </select>
      </div>

      <button onclick="fetchRate()">ê¸ˆë¦¬ ì¡°íšŒí•˜ê¸°</button>

      <div id="result" class="result">
        <h2>ì¡°íšŒ ê²°ê³¼</h2>
        <div class="rate-info">
          <div class="rate-list">
            <!-- ì—¬ê¸°ì— ì€í–‰ ëª©ë¡ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
          </div>
        </div>
      </div>

      <div id="error" class="error"></div>
    </div>

    <script>
      async function fetchRate() {
        const result = document.getElementById('result');
        const error = document.getElementById('error');
        const rateList = document.querySelector('.rate-list');
        
        result.style.display = 'none';
        error.style.display = 'none';
        rateList.innerHTML = '';
        
        try {
          const serviceKey = encodeURIComponent('Fd9vStrV5WKcvb5kTCXeBBw1zyOOxNrOysX80lQ02PLaIWqI7PFfY7PlcJopX/3kd5FYkiHYt6QYbhItGuhIhQ==');
          const params = new URLSearchParams({
            serviceKey: serviceKey,
            cbGrd: document.getElementById('cbGrd').value,
            jobCd: document.getElementById('jobCd').value,
            houseTycd: document.getElementById('houseTycd').value,
            age: document.getElementById('age').value,
            dataType: 'XML',
            numOfRows: '100',
            pageNo: '1'
          });

          const url = `http://apis.data.go.kr/B551408/rent-loan-rate-info/rate-list?serviceKey=${serviceKey}&numOfRows=10&pageNo=1&dataType=xml`;
          console.log('ìš”ì²­ URL:', url);
          
          const response = await fetch(url);
          const text = await response.text();
          console.log('ì‘ë‹µ ë°ì´í„°:', text);
          
          const parser = new DOMParser();
          const xmlDoc = parser.parseFromString(text, 'text/xml');
          
          const items = xmlDoc.querySelectorAll('item');
          console.log('íŒŒì‹±ëœ ì•„ì´í…œ ìˆ˜:', items.length);
          
          if (items.length === 0) {
            throw new Error('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
          }

          // ì€í–‰ ë°ì´í„°ë¥¼ ë°°ì—´ë¡œ ë³€í™˜
          const banks = Array.from(items).map(item => ({
            name: item.querySelector('organId')?.textContent || '-',
            interest: parseFloat(item.querySelector('interest4_1')?.textContent || '0')
          }));

          // ê¸ˆë¦¬ê°€ 0ë³´ë‹¤ í° ì€í–‰ë§Œ í•„í„°ë§í•˜ê³  ê¸ˆë¦¬ìˆœìœ¼ë¡œ ì •ë ¬
          const validBanks = banks
            .filter(bank => bank.interest > 0)
            .sort((a, b) => a.interest - b.interest);

          if (validBanks.length === 0) {
            throw new Error('í˜„ì¬ ì „ì„¸ëŒ€ì¶œ ìƒí’ˆì„ ì œê³µí•˜ëŠ” ì€í–‰ì´ ì—†ìŠµë‹ˆë‹¤.');
          }

          // ì •ë ¬ëœ ì€í–‰ ëª©ë¡ì„ í™”ë©´ì— í‘œì‹œ
          validBanks.forEach(bank => {
            const bankItem = document.createElement('div');
            bankItem.className = 'bank-item';
            bankItem.innerHTML = `
              <span class="bank-name">${bank.name}</span>
              <span class="bank-rate">${bank.interest}%</span>
            `;
            rateList.appendChild(bankItem);
          });

          result.style.display = 'block';
        } catch (error) {
          console.error('API í˜¸ì¶œ ì˜¤ë¥˜:', error);
          document.getElementById('error').textContent = `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
          document.getElementById('error').style.display = 'block';
        }
      }
    </script>
  </body>
</html>
